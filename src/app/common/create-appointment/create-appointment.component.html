<div class="container-fluid p-3">
  <div class="card">
    <div class="card-header">
      <h5 class="card-title">Create Appointment</h5>
    </div>

    <div class="card-body">
      <!-- Warning -->
      <div
        *ngIf="hasPendingAppointment"
        class="alert alert-warning d-flex align-items-center"
        role="alert"
      >
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        You already have an ongoing appointment. Please complete it first.
      </div>

      <!-- FORM -->
      <form
        *ngIf="!hasPendingAppointment"
        [formGroup]="appointmentForm"
        (ngSubmit)="submit()"
        class="appointment-wrap"
      >
        <!-- LEFT SIDE -->
        <div class="appointment-left">
          <div class="row g-3">
            <!-- Name -->
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="text"
                  id="name"
                  class="form-control"
                  formControlName="name"
                  placeholder="Name"
                />
                <label for="name">Name</label>
              </div>
            </div>

            <!-- Contact -->
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="text"
                  id="contact"
                  class="form-control"
                  formControlName="contact"
                  placeholder="Contact"
                />
                <label for="contact">Contact</label>
              </div>
            </div>

            <!-- Email -->
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="email"
                  id="email"
                  class="form-control"
                  formControlName="email"
                  placeholder="Email"
                />
                <label for="email">Email</label>
              </div>
            </div>

            <!-- Date -->
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="date"
                  id="date"
                  class="form-control"
                  formControlName="date"
                  [min]="minDate"
                  (change)="onDateChange(appointmentForm.value.date)"
                />
                <label for="date">Date</label>
              </div>
            </div>

            <!-- Purpose -->
            <div class="col-12">
              <div class="form-floating">
                <select
                  id="serviceId"
                  class="form-select"
                  formControlName="serviceId"
                >
                  <option value="" disabled>Select Purpose</option>
                  <option
                    *ngFor="let service of services$"
                    [value]="service.id"
                  >
                    {{ service.title }}
                  </option>
                </select>
                <label for="serviceId">Purpose</label>
              </div>
            </div>
          </div>
          <!-- end row -->
        </div>

        <!-- RIGHT SIDE -->
        <div class="appointment-right mt-3">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <h4 class="m-0">Select Time</h4>

            <div
              *ngIf="isGettingSchedules"
              class="spinner-border text-primary"
            ></div>
          </div>
        </div>
        <div class="d-flex mb-3 flex-wrap gap-3">
          <span
            *ngFor="let item of timeSlots$"
            class="badge rounded-pill me-2"
            [ngClass]="{
              'bg-primary': selectedTimeSlot === item && isAvailable(item),
              'bg-secondary': selectedTimeSlot !== item && isAvailable(item),
              'bg-light text-muted': !isAvailable(item)
            }"
            [class.disabled]="!isAvailable(item)"
            (click)="onSelectTimeSlot(item)"
          >
            {{ item }}
          </span>
        </div>

        <!-- Submit -->
        <div class="col-12 text-center mt-3">
          <button
            class="btn btn-success w-100 w-md-auto"
            [disabled]="appointmentForm.invalid && selectedTimeSlot === null"
          >
            Submit Appointment
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
