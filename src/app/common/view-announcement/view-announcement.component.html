<div class="container py-5">
  <!-- ðŸ”¹ Loader -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status"></div>
  </div>

  <!-- ðŸ”¹ Main Content -->
  <div
    *ngIf="!isLoading && announcement"
    class="d-flex flex-wrap gap-4 align-items-start"
  >
    <!-- ðŸ“„ Announcement -->
    <div
      [ngClass]="{
        'flex-grow-1': true,
        'w-100': isAnnouncement(announcement.type),
        'w-100 w-lg-66': !isAnnouncement(announcement.type)
      }"
    >
      <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
        <img
          *ngIf="announcement.image"
          [src]="announcement.image"
          alt="{{ announcement.title }}"
          class="img-fluid"
          style="width: 100%; max-height: 420px; object-fit: cover"
        />

        <div class="card-body p-4">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <span
              class="badge text-bg-primary text-capitalize px-3 py-2 rounded-pill"
              >{{ announcement.type }}</span
            >
            <small class="text-muted">{{
              announcement.createdAt | date : "mediumDate"
            }}</small>
          </div>

          <h2 class="fw-bold mb-3 text-dark">{{ announcement.title }}</h2>
          <p class="text-secondary fs-5 mb-4">{{ announcement.summary }}</p>

          <div
            class="announcement-content fs-6 text-body"
            [innerHTML]="announcement.content"
          ></div>

          <div class="mt-4">
            <a
              *ngIf="announcement.source"
              [href]="announcement.source"
              target="_blank"
              class="btn btn-outline-primary rounded-pill px-4"
            >
              View Source
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- ðŸ’¬ Comments Sidebar -->
    <div
      *ngIf="announcement.type !== 'announcement'"
      class="flex-grow-1 w-100 w-lg-33"
    >
      <div class="card border-0 shadow-sm rounded-4">
        <div class="card-body p-4">
          <h5 class="fw-bold mb-3">Comments</h5>

          <!-- Add Comment Box -->
          <div class="mb-4">
            <textarea
              [formControl]="newComment"
              class="form-control rounded-3"
              rows="3"
              placeholder="Write a comment..."
            ></textarea>
            <button
              class="btn btn-primary w-100 mt-2 rounded-pill"
              (click)="addComment()"
              [disabled]="newComment.invalid"
            >
              Post Comment
            </button>
          </div>

          <!-- Comments List -->
          <div *ngIf="comments$ | async as comments">
            <div *ngIf="comments.length; else noComments">
              <div
                *ngFor="let c of comments"
                class="comment-item border rounded-3 p-3 mb-3 bg-light"
              >
                <div class="d-flex align-items-center mb-2">
                  <img
                    [src]="c.profile || '../../../assets/images/profile.png'"
                    alt="User"
                    class="rounded-circle me-2 border"
                    width="40"
                    height="40"
                    style="object-fit: cover"
                  />
                  <div>
                    <strong class="d-block text-dark">{{ c.name }}</strong>
                    <small class="text-muted">
                      {{ c.createdAt | date : "MMM d, y, h:mm a" }}
                    </small>
                  </div>
                </div>
                <p class="mb-0 text-body">{{ c.message }}</p>
              </div>
            </div>

            <ng-template #noComments>
              <p class="text-muted text-center mt-3">
                No comments yet. Be the first!
              </p>
            </ng-template>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
